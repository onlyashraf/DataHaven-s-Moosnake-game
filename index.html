<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Moosnake Game with Key Power-Up</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }
    body {
      background: url("https://placehold.co/1920x1080/0d1b2a/ffffff?text=Background") no-repeat center center fixed;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      text-align: center;
      padding-top: 10px;
    }
    #logo {
      display: block;
      margin: 10px auto;
      width: 100px;
      height: auto;
      border-radius: 50%;
    }
    h1 {
      font-family: 'Press Start 2P', cursive;
      font-size: 22px;
      color: #ffb703;
      text-shadow: 3px 3px 0px #fb8500, 6px 6px 0px #023047;
      margin-bottom: 5px;
      letter-spacing: 2px;
    }
    h2 {
      font-family: 'Press Start 2P', cursive;
      font-size: 14px;
      color: #fb8500;
      text-shadow: 1px 1px 0px #023047;
      margin-bottom: 15px;
      letter-spacing: 1px;
    }
    .game-container {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
      max-width: 100%;
    }
    canvas {
      background: linear-gradient(145deg, #0d1b2a, #1b263b);
      border: 3px solid #415a77;
      border-radius: 15px;
      box-shadow: 0px 0px 25px rgba(0, 0, 0, 0.6),
                  0px 0px 50px rgba(65, 90, 119, 0.4) inset;
      display: block;
      max-width: 100%;
      height: auto;
      touch-action: none;
    }
    #ui {
      margin-top: 15px;
      text-align: center;
    }
    button {
      background: #ffb703;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease-in-out, transform 0.15s ease-in-out;
      font-family: 'Press Start 2P', cursive;
      text-shadow: 1px 1px 0px #023047;
      color: #023047;
    }
    button:hover {
      background: #fb8500;
      transform: scale(1.05);
    }
    .side-panel {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }
    .side-box {
      width: 180px;
      font-family: 'Press Start 2P', cursive;
      font-size: 10px;
      background: rgba(255, 255, 255, 0.8);
      color: #023047;
      border: 2px solid #415a77;
      border-radius: 12px;
      padding: 10px;
      text-align: left;
      line-height: 1.5;
    }
    .side-box h3 {
      font-size: 12px;
      margin-bottom: 5px;
      text-align: center;
      color: #fb8500;
      text-shadow: 1px 1px 0px #023047;
    }
    #tomatoMan {
      width: 160px;
      height: auto;
      border-radius: 12px;
      border: 2px solid #415a77;
      box-shadow: 0px 0px 12px rgba(0,0,0,0.4);
    }
    #messageBox {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #ffb703;
      border-radius: 15px;
      padding: 25px;
      color: #fff;
      text-align: center;
      font-family: 'Press Start 2P', cursive;
      z-index: 100;
      display: none;
      max-width: 80%;
    }

    @media (max-width: 768px) {
      .game-container {
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }
      canvas {
        width: 95vw;
        height: auto;
      }
      .side-box, .side-panel {
        width: 90%;
        text-align: center;
        font-size: 12px;
      }
      #ui button {
        font-size: 18px;
        padding: 12px 24px;
        width: 90%;
        max-width: 250px;
      }
    }
  </style>
</head>
<body>
  <img src="https://placehold.co/100x100/3d5a80/ffffff?text=Logo" alt="DataHaven Logo" id="logo">
  <h1>🫎 DataHaven's Moosnake Game</h1>
  <h2>BY: TOMATO MAN</h2>

  <div class="game-container">
    <div class="side-box">
      <h3>🎮 Controls</h3>
      ↑ / W = Up<br>
      ↓ / S = Down<br>
      ← / A = Left<br>
      → / D = Right<br>
      👆 Swipe = Mobile
    </div>

    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <div class="side-panel">
      <div class="side-box">
        <h3>📜 Rules</h3>
        🥜 Eat acorns = +1<br>
        🔑 Grab key = +10<br>
        ❌ Don’t hit yourself<br>
        ⏩ Snake speeds up slowly<br>
        🌍 Wrap around edges
      </div>
      <img src="https://placehold.co/160x160/fb8500/023047?text=Tomato+Man" alt="Tomato Man" id="tomatoMan">
    </div>
  </div>

  <div id="ui">
    <button id="startBtn">Start Game</button>
    <button id="pauseBtn" style="display:none;">Pause</button>
    <button id="resumeBtn" style="display:none;">Resume</button>
    <button id="restartBtn" style="display:none;">Restart</button>
    <button id="fullscreenBtn">Fullscreen</button>
  </div>
  
  <div id="messageBox">
    <h3>Game Over!</h3>
    <p id="finalScore"></p>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const startBtn = document.getElementById("startBtn");
    const pauseBtn = document.getElementById("pauseBtn");
    const resumeBtn = document.getElementById("resumeBtn");
    const restartBtn = document.getElementById("restartBtn");
    const fullscreenBtn = document.getElementById("fullscreenBtn");
    const messageBox = document.getElementById("messageBox");
    const finalScoreEl = document.getElementById("finalScore");

    let gridSize = 25;
    const baseCols = 24;
    const baseRows = 16;
    let cols = baseCols;
    let rows = baseRows;

    let snake, direction, nextDirection, food, score, gameInterval, gameRunning, speed;

    const acorn = new Image();
    acorn.src = "https://placehold.co/30x30/6a040f/fff?text=🥜";
    const mooseHead = new Image();
    mooseHead.src = "https://placehold.co/30x30/8d8d8d/000?text=🫎";
    const keyImg = new Image();
    keyImg.src = "https://placehold.co/30x30/ffb703/000?text=🔑";

    let key = null;
    let keyVisible = false;
    let keyTimer, keySpawnTimer;
    let fullscreen = false;

    function resizeCanvas() {
      if (fullscreen) {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      } else if (window.innerWidth < 768) {
        canvas.width = Math.floor(window.innerWidth * 0.9);
        canvas.height = Math.floor(canvas.width * (baseRows / baseCols));
      } else {
        canvas.width = 600;
        canvas.height = 400;
      }
      gridSize = Math.floor(Math.min(canvas.width / baseCols, canvas.height / baseRows));
      cols = baseCols;
      rows = baseRows;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    function resetGame() {
      snake = [{ x: 5, y: 5 }];
      direction = { x: 1, y: 0 };
      nextDirection = { x: 1, y: 0 };
      score = 0;
      speed = 150;
      placeFood();
      removeKey();
      scheduleKey();
      messageBox.style.display = "none";
    }

    function placeFood() {
      let valid = false;
      while (!valid) {
        food = { x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows) };
        valid = !snake.some(seg => seg.x === food.x && seg.y === food.y);
      }
    }

    function placeKey() {
      let valid = false;
      while (!valid) {
        key = { x: Math.floor(Math.random() * cols), y: Math.floor(Math.random() * rows) };
        valid = !snake.some(seg => seg.x === key.x && seg.y === key.y) &&
                !(food.x === key.x && food.y === key.y);
      }
      keyVisible = true;
      clearTimeout(keyTimer);
      keyTimer = setTimeout(removeKey, 8000);
    }

    function removeKey() {
      key = null;
      keyVisible = false;
      scheduleKey();
    }

    function scheduleKey() {
      clearTimeout(keySpawnTimer);
      keySpawnTimer = setTimeout(() => {
        if (!keyVisible) placeKey();
      }, 10000);
    }

    function drawSnake() {
      snake.forEach((segment, index) => {
        if (index === 0) drawMooseHead(segment.x, segment.y);
        else {
          ctx.fillStyle = "#219ebc";
          ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
        }
      });
    }

    function drawMooseHead(x, y) {
      const size = gridSize * 1.6;
      const cx = x * gridSize + gridSize / 2;
      const cy = y * gridSize + gridSize / 2;
      const imageRotationOffset = Math.PI / 2;
      const angle = Math.atan2(direction.y, direction.x) + imageRotationOffset;
      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(angle);
      ctx.drawImage(mooseHead, -size / 2, -size / 2, size, size);
      ctx.restore();
    }

    function drawFood() {
      ctx.drawImage(acorn, food.x * gridSize, food.y * gridSize, gridSize, gridSize);
    }

    function drawKey() {
      if (keyVisible && key) {
        const size = gridSize * 1.2;
        ctx.drawImage(keyImg, key.x * gridSize, key.y * gridSize, size, size);
      }
    }
    
    function drawScore() {
      ctx.font = "bold 20px 'Press Start 2P'";
      ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
      ctx.textAlign = "right";
      ctx.fillText("Score: " + score, canvas.width - 20, 30);
    }

    function update() {
      const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };

      if (head.x < 0) head.x = cols - 1;
      if (head.x >= cols) head.x = 0;
      if (head.y < 0) head.y = rows - 1;
      if (head.y >= rows) head.y = 0;

      if (snake.some(seg => seg.x === head.x && seg.y === head.y)) {
        gameOver();
        return;
      }

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        placeFood();
        speed = Math.max(100, 150 * Math.pow(0.99, score));
        clearInterval(gameInterval);
        gameInterval = setInterval(gameLoop, speed);
      } else if (keyVisible && key && head.x === key.x && head.y === key.y) {
        score += 10;
        removeKey();
      } else {
        snake.pop();
      }

      direction = nextDirection;
    }

    function draw() {
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, "#0d1b2a");
      gradient.addColorStop(1, "#1b263b");
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      drawFood();
      drawKey();
      drawSnake();
      drawScore();
    }

    function gameLoop() {
      update();
      draw();
    }

    function startGame() {
      resetGame();
      gameRunning = true;
      startBtn.style.display = "none";
      pauseBtn.style.display = "inline-block";
      resumeBtn.style.display = "none";
      restartBtn.style.display = "none";
      clearInterval(gameInterval);
      gameInterval = setInterval(gameLoop, speed);
    }

    function pauseGame() {
      clearInterval(gameInterval);
      gameRunning = false;
      pauseBtn.style.display = "none";
      resumeBtn.style.display = "inline-block";
    }

    function resumeGame() {
      if (!gameRunning) {
        gameRunning = true;
        gameInterval = setInterval(gameLoop, speed);
        pauseBtn.style.display = "inline-block";
        resumeBtn.style.display = "none";
      }
    }

    function gameOver() {
      clearInterval(gameInterval);
      gameRunning = false;
      finalScoreEl.textContent = "Your Score: " + score;
      messageBox.style.display = "block";
      restartBtn.style.display = "inline-block";
      pauseBtn.style.display = "none";
      resumeBtn.style.display = "none";
    }

    document.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();
      if ((key === "arrowup" || key === "w") && direction.y !== 1) nextDirection = { x: 0, y: -1 };
      if ((key === "arrowdown" || key === "s") && direction.y !== -1) nextDirection = { x: 0, y: 1 };
      if ((key === "arrowleft" || key === "a") && direction.x !== 1) nextDirection = { x: -1, y: 0 };
      if ((key === "arrowright" || key === "d") && direction.x !== -1) nextDirection = { x: 1, y: 0 };
    });

    let touchStartX = 0, touchStartY = 0;
    let touchEndX = 0, touchEndY = 0;

    canvas.addEventListener("touchstart", (e) => {
      const touch = e.touches[0];
      touchStartX = touch.clientX;
      touchStartY = touch.clientY;
    });

    canvas.addEventListener("touchend", (e) => {
      const touch = e.changedTouches[0];
      touchEndX = touch.clientX;
      touchEndY = touch.clientY;
      handleSwipe();
    });

    function handleSwipe() {
      const dx = touchEndX - touchStartX;
      const dy = touchEndY - touchStartY;

      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 30 && direction.x !== -1) nextDirection = { x: 1, y: 0 };
        if (dx < -30 && direction.x !== 1) nextDirection = { x: -1, y: 0 };
      } else {
        if (dy > 30 && direction.y !== -1) nextDirection = { x: 0, y: 1 };
        if (dy < -30 && direction.y !== 1) nextDirection = { x: 0, y: -1 };
      }
    }

    function enterFullscreen() {
      if (canvas.requestFullscreen) {
        canvas.requestFullscreen();
      } else if (canvas.webkitRequestFullscreen) {
        canvas.webkitRequestFullscreen();
      } else if (canvas.msRequestFullscreen) {
        canvas.msRequestFullscreen();
      }
    }

    function exitFullscreen() {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      }
    }

    fullscreenBtn.addEventListener("click", () => {
      if (!fullscreen) {
        enterFullscreen();
      } else {
        exitFullscreen();
      }
    });

    document.addEventListener("fullscreenchange", () => {
      fullscreen = !!document.fullscreenElement;
      resizeCanvas();
      document.getElementById("ui").style.display = fullscreen ? "none" : "block";
      document.querySelector(".side-panel").style.display = fullscreen ? "none" : "flex";
      messageBox.style.display = "none"; // Hide message box if screen size changes
    });

    startBtn.addEventListener("click", startGame);
    pauseBtn.addEventListener("click", pauseGame);
    resumeBtn.addEventListener("click", resumeGame);
    restartBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
